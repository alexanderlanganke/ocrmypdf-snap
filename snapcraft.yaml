name: ocrmypdf # you probably want to 'snapcraft register <name>'
title: ocrmypdf
base: core20 # the base snap is the execution environment for this snap
version: '0.1' # just for humans, typically '1.2+git' or '1.3.2'
summary: Hobby Project GUI for the Python Program "OCRmyPDF" by James R. Barlow
description: OCRmyPDF by James R. Barlow
grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots
#
architectures: [amd64]

environment:
    TESSDATA_PREFIX: $SNAP/usr/share/tesseract-ocr/4.00/tessdata
    GS_LIB: $SNAP/usr/share/ghostscript/9.26/Resource/Init
    GS_FONTPATH: $SNAP/usr/share/ghostscript/9.26/Resource/Font
    LD_LIBRARY_PATH: $SNAP/usr/lib/x86_64-linux-gnu

apps:
  ocrmypdf:
    command: python3 ocrmypdf
#    desktop: $SNAPCRAFT_PROJECT_DIR/gui/ocrmypdfgui.desktop
#    extensions: [gnome-3-38]

    plugs:
      - desktop
      - desktop-legacy
      - wayland
      - x11
      - home
      - removable-media


parts:
  ocrmypdf:
    # See 'snapcraft plugins'
    plugin: python
    source: .
    stage-packages: [ghostscript, icc-profiles-free, liblept5, libxml2, pngquant, tesseract-ocr-all, unpaper, qpdf, zlib1g]

    python-packages:
      - ocrmypdf
#      - ocrmypdfgui
#      - cffi  # must be a setup and install requirement
#      - coloredlogs # strictly optional
#      - img2pdf  # pure Python, so track HEAD closely
#      - pdfminer.six
#      - pikepdf
#      - Pillow
#      - pluggy
#      - reportlab
#      - setuptools
#      - tqdm

    override-build: |
      snapcraftctl build
      sed -i 's/find_library(libname)/"liblept.so.5"/g' $SNAPCRAFT_PART_INSTALL/lib/python3.8/site-packages/ocrmypdf/leptonica.py

#  cleanup:
#    after:  # Make this part run last; list all your other parts here
#      - ocrmypdf
#    plugin: nil
#    build-snaps:  # List all content-snaps and base snaps you're using here
#      - core20
#    override-prime: |
#      set -eux
#      for snap in "core20"; do  # List all content-snaps and base snaps you're using here
#          cd "/snap/$snap/current" && find . -type f,l -exec rm -f "$SNAPCRAFT_PRIME/{}" \;
#      done
